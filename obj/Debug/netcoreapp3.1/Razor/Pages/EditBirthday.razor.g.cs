#pragma checksum "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "5ce4fc5fac7236aca84d6811ebcdf35a9a3bdeca"
// <auto-generated/>
#pragma warning disable 1591
namespace SQL_Connection.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using SQL_Connection;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\_Imports.razor"
using SQL_Connection.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
using SQL_Connection.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
using System.Globalization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/edit_birthdays")]
    public partial class EditBirthday : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.AddMarkupContent(0, "<h1>Add or remove birthdays</h1>\n");
            __builder.AddMarkupContent(1, "<p>Name:</p>\n");
            __builder.OpenElement(2, "input");
            __builder.AddAttribute(3, "type", "text");
            __builder.AddAttribute(4, "oninput", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.ChangeEventArgs>(this, 
#nullable restore
#line 10 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                                           (EventArgs) => {SetName(EventArgs.Value.ToString());}

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(5, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 10 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                           name

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(6, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => name = __value, name));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(7, "\n<br><br>\n");
            __builder.AddMarkupContent(8, "<p>Month:</p>\n");
            __builder.OpenElement(9, "input");
            __builder.AddAttribute(10, "type", "text");
            __builder.AddAttribute(11, "oninput", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.ChangeEventArgs>(this, 
#nullable restore
#line 13 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                                            (EventArgs) => {SetMonth(EventArgs.Value.ToString());}

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(12, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 13 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                           month

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(13, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => month = __value, month));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(14, "\n<br><br>\n");
            __builder.AddMarkupContent(15, "<p>Day:</p>\n");
            __builder.OpenElement(16, "input");
            __builder.AddAttribute(17, "type", "text");
            __builder.AddAttribute(18, "oninput", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.ChangeEventArgs>(this, 
#nullable restore
#line 16 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                                          (EventArgs) => {SetDay(EventArgs.Value.ToString());}

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(19, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 16 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                           day

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(20, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => day = __value, day));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(21, "\n<br><br>\n");
            __builder.OpenElement(22, "button");
            __builder.AddAttribute(23, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 18 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                  AddBirthday

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(24, "Add");
            __builder.CloseElement();
            __builder.AddMarkupContent(25, "\n");
            __builder.OpenElement(26, "button");
            __builder.AddAttribute(27, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 19 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
                  DelBirthday

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(28, "Delete");
            __builder.CloseElement();
            __builder.AddMarkupContent(29, "\n<br><br><br>\n");
            __builder.AddMarkupContent(30, "<h3>Current Birthdays:</h3>\n");
            __builder.OpenElement(31, "ul");
            __builder.AddMarkupContent(32, "\n");
#nullable restore
#line 23 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
     foreach (String birthday in getBirthdays(1000))
    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(33, "        ");
            __builder.OpenElement(34, "li");
#nullable restore
#line 25 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
__builder.AddContent(35, birthday);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(36, "\n");
#nullable restore
#line 26 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
    }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 29 "C:\Users\lhotchkiss\source\repos\SQL-Connection\Sql-connection-master\Sql-connection-master\Pages\EditBirthday.razor"
       

    String name;
    String month;
    String day;
    String birthdayListFile = "Data/birthday_list.json";

    void SetName(String Val)
    {
        name = Val;
    }

    void SetMonth(String Val)
    {
        month = Val;
    }

    void SetDay(String Val)
    {
        day = Val;
    }

    async void AddBirthday()
    {
        try
        {
            // read in the file
            Dictionary<String, List<int>> items;
            using (StreamReader r = new StreamReader(birthdayListFile))
            {
                string json = r.ReadToEnd();
                items = JsonConvert.DeserializeObject<Dictionary<String, List<int>>>(json); // The json should be {"Person name":[month, day],}
            }
            List<int> date = new List<int>();
            date.Add(Int32.Parse(month));
            date.Add(Int32.Parse(day));
            items.Add(name, date);
            using (StreamWriter file = File.CreateText(birthdayListFile))
            {
                String json = JsonConvert.SerializeObject(items);
                file.Write(json);
            }

            await JSRuntime.InvokeVoidAsync("alert", "Birthday added successfully!");
        }
        catch (FormatException)
        {
            await JSRuntime.InvokeVoidAsync("alert", "Day and month must be numbers");
        }
        catch (ArgumentException)
        {
            await JSRuntime.InvokeVoidAsync("alert", "Name already exists");
        }
        catch (Exception e)
        {
            await JSRuntime.InvokeVoidAsync("alert", "An error occurred:\n" + e.GetType().ToString() + "\n" + e.Message);
        }
    }

    async void DelBirthday()
    {
        try
        {
            // read in the file
            Dictionary<String, List<int>> items;
            using (StreamReader r = new StreamReader(birthdayListFile))
            {
                string json = r.ReadToEnd();
                items = JsonConvert.DeserializeObject<Dictionary<String, List<int>>>(json); // The json should be {"Person name":[month, day],}
            }
            items.Remove(name);
            using (StreamWriter file = File.CreateText(birthdayListFile))
            {
                String json = JsonConvert.SerializeObject(items);
                file.Write(json);
            }

            await JSRuntime.InvokeVoidAsync("alert", "Birthday deleted successfully!");
        }
        catch(KeyNotFoundException)
        {
            await JSRuntime.InvokeVoidAsync("alert", "Name not found");
        } catch(Exception e)
        {
            await JSRuntime.InvokeVoidAsync("alert", "An error occurred:\n" + e.GetType().ToString() + "\n" + e.Message);
        }
    }

    /*
    This function gets a number of birthdays equal to count
    It will return them preformatted as "name: date"
    */
    List<String> getBirthdays(int count)
    {
        Dictionary<String, DateTime> birthday_dict = readBirthdays();
        List<String> all_birthdays = birthday_dict.Keys.ToList();
        all_birthdays.Sort((a, b) => ((birthday_dict[a] - DateTime.Today).Days - (birthday_dict[b] - DateTime.Today).Days));
        // after sorting all_birthdays, the nest step is to add the dates to it so the list is useable
        all_birthdays = (from name in all_birthdays select name + ": " + birthday_dict[name].Month.ToString() + "/" + birthday_dict[name].Day.ToString()).ToList();

        if (all_birthdays.Count < count) { count = all_birthdays.Count; } //if you ask for more birthdays than we have, just give them all of them

        List<string> birthdays = all_birthdays.Take(count).ToList();

        return birthdays;
    }

    /*
    This function reads the excel file birthdayListFile and create a dictionary of names to DateTime objects
    For simplicity off comparisons late, the DateTime objects will represent the person's next birthday this year
    */
    Dictionary<String, DateTime> readBirthdays()
    {
        Dictionary<String, DateTime> birthdays = new Dictionary<String, DateTime>();
        DateTime today = DateTime.Today;

        // read in the file
        Dictionary<String, List<int>> items;
        using (StreamReader r = new StreamReader(birthdayListFile))
        {
            string json = r.ReadToEnd();
            items = JsonConvert.DeserializeObject<Dictionary<String, List<int>>>(json); // The json should be {"Person name":[month, day],}
        }

        foreach (String name in items.Keys)
        {
            DateTime date = new DateTime(today.Year, items[name][0], items[name][1]);
            if (date < today) { date = date.AddYears(1); }
            birthdays[name] = date;
        }

        return birthdays;
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
    }
}
#pragma warning restore 1591
